<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapperInterface.ProductMapper">

  <select id="getAllProducts" resultType="com.example.demo.domain.ProductDTO">
    SELECT 
      prod_no AS prodNo,
      prod_nm AS prodNm,
      prod_price AS prodPrice,
      category,
      status,
      prod_cnt AS prodCnt,
      publisher,
      author_nm AS authorNm,
      DATE_FORMAT(reg_dtm, '%Y-%m-%d %H:%i:%s') AS regDtm,
      DATE_FORMAT(upd_dtm, '%Y-%m-%d %H:%i:%s') AS updDtm,
      book_desc AS bookDesc
    FROM product
  </select>
  
  <insert id="insertProduct" useGeneratedKeys="true" keyProperty="prodNo">
    INSERT INTO product
    (prod_nm, prod_price, category, status, prod_cnt, publisher, author_nm, reg_dtm, book_desc)
    VALUES
    (#{prodNm}, #{prodPrice}, #{category}, #{status}, #{prodCnt}, #{publisher}, #{authorNm}, NOW(), #{bookDesc})
  </insert>
  
	<select id="getProductById" parameterType="int" resultType="ProductDTO">
	  SELECT 
	    prod_no AS prodNo,
	    prod_nm AS prodNm,
	    prod_price AS prodPrice,
	    category,
	    status,
	    prod_cnt AS prodCnt,
	    publisher,
	    author_nm AS authorNm,
	    DATE_FORMAT(reg_dtm, '%Y-%m-%d %H:%i:%s') AS regDtm,
	    DATE_FORMAT(upd_dtm, '%Y-%m-%d %H:%i:%s') AS updDtm,
	    book_desc AS bookDesc
	  FROM product
	  WHERE prod_no = #{prodNo}
	</select>
	
	<update id="updateProduct" parameterType="com.example.demo.domain.ProductDTO">
	  UPDATE product
	  SET
	    prod_nm = #{prodNm},
	    prod_price = #{prodPrice},
	    category = #{category},
	    status = #{status},
	    prod_cnt = #{prodCnt},
	    publisher = #{publisher},
	    author_nm = #{authorNm},
	    upd_dtm = NOW(),
	    book_desc = #{bookDesc}
	  WHERE prod_no = #{prodNo}
	</update>
	
	<delete id="deleteProduct">
		DELETE FROM product where prod_no = #{prodNo}
	</delete>

</mapper>
